<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Luna Wedding — June 5, 2026</title>

  <!-- Canonical -->
  <link rel="canonical" href="https://luna.wedding/">

  <!-- Basic meta -->
  <meta name="title" content="Luna Wedding — June 5, 2026" />
  <meta name="description" content="Luna Wedding — RSVP • June 5, 2026" />

  <!-- Open Graph (iMessage uses these; must be absolute URLs) -->
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Luna Wedding" />
  <meta property="og:title" content="Luna Wedding — June 5, 2026" />
  <meta property="og:description" content="Luna Wedding — RSVP • June 5, 2026" />
  <meta property="og:url" content="https://luna.wedding/" />
  <meta property="og:image" content="https://luna.wedding/assets/og.jpg?v=24" />
  <meta property="og:image:type" content="image/jpeg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter (also helps some link preview parsers) -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Luna Wedding — June 5, 2026" />
  <meta name="twitter:description" content="Luna Wedding — RSVP • June 5, 2026" />
  <meta name="twitter:image" content="https://luna.wedding/assets/og.jpg?v=24" />

  <!-- Monogram favicon -->
  <link rel="icon" type="image/svg+xml"
    href='data:image/svg+xml;utf8,<?xml version="1.0" encoding="UTF-8"?>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
      <rect width="512" height="512" rx="128" fill="%23ffffff"/>
      <g transform="translate(0,20)">
        <text x="50%" y="55%" text-anchor="middle"
          font-family="Georgia, Times New Roman, serif" font-style="italic"
          font-size="280" fill="%23000000">L</text>
        <text x="60%" y="72%" text-anchor="middle"
          font-family="Georgia, Times New Roman, serif" font-style="italic"
          font-size="220" fill="%23000000">M</text>
      </g>
    </svg>' />

  <!-- Performance -->
  <link rel="preload" as="image" href="assets/bg.jpg?v=24" fetchpriority="high">
  <link rel="preload" as="image" href="assets/image.jpg?v=24">
</head>
  
  <style>
    :root { --fallback:#000; --hint-bg: rgba(255,255,255,.92); --hint-fg:#111; }
    html,body{
      height:100%; margin:0; background:var(--fallback); overflow:hidden;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    }

    /* Page animations */
    @keyframes fadeBg { from {opacity:0} to {opacity:1} }
    @keyframes fadeCard { from {opacity:0; transform:translate(-50%,-48%) scale(.985)} to {opacity:1; transform:translate(-50%,-50%) scale(1)} }
    @keyframes hintIn { from {opacity:0; transform:translate(-50%,-46%)} to {opacity:1; transform:translate(-50%,-40%)} }
    @keyframes hintOut { to {opacity:0; transform:translate(-50%,-36%)} }

    .bg { position:fixed; inset:0; opacity:0; animation:fadeBg 900ms ease-out .05s forwards; }
    .bg img { width:100vw; height:100vh; object-fit:cover; object-position:center; user-select:none; -webkit-user-drag:none; }

    .invite{
      position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
      width:min(92vw,900px); max-height:88vh; height:auto; border-radius:12px; background:#fff;
      box-shadow:0 20px 48px rgba(0,0,0,.25);
      opacity:0; animation:fadeCard .75s cubic-bezier(.21,.98,.25,.99) .2s forwards;
      cursor:zoom-in; user-select:none; -webkit-user-drag:none; z-index:1;
    }

    .hint{
      position:fixed; left:50%; top:calc(50% + min(50vh, 460px));
      transform:translate(-50%,-40%); padding:8px 12px; border-radius:999px;
      background:var(--hint-bg); color:var(--hint-fg); font-size:13px;
      box-shadow:0 8px 24px rgba(0,0,0,.18); opacity:0; animation:hintIn .5s ease .8s forwards;
      pointer-events:none; z-index:2;
    }
    .hint.hide{ animation:hintOut .35s ease forwards; }

    .lightbox{
      position:fixed; inset:0; background:rgba(0,0,0,.6);
      display:flex; align-items:center; justify-content:center;
      opacity:0; pointer-events:none; z-index:10;
      transition:opacity 280ms ease, background-color 180ms ease;
      -webkit-backdrop-filter: blur(8px) saturate(120%); backdrop-filter: blur(8px) saturate(120%);
    }
    .lightbox.visible{ opacity:1; pointer-events:auto; }
    .lightbox.closing{ background:rgba(0,0,0,.95); }
    .lightbox img{
      max-width:94vw; max-height:92vh; border-radius:14px; box-shadow:0 24px 64px rgba(0,0,0,.6);
      transform:scale(.96); transition:transform 280ms cubic-bezier(.23,1,.32,1); touch-action:pinch-zoom;
    }
    .lightbox.visible img{ transform:scale(1) }
    .lightbox.closing img{ transform:scale(.98) }
    .close{
      position:fixed; top:calc(12px + env(safe-area-inset-top)); right:calc(12px + env(safe-area-inset-right));
      width:44px; height:44px; border:0; border-radius:999px; background:#fff; color:#000; font-size:22px; line-height:1; cursor:pointer;
      opacity:0; transform:scale(.85); transition:opacity 260ms ease .1s, transform 260ms ease .1s;
    }
    .lightbox.visible .close{ opacity:1; transform:scale(1) }

    .music{
      position:fixed; left:12px; bottom:calc(12px + env(safe-area-inset-bottom));
      display:inline-flex; align-items:center; gap:8px; padding:10px 12px;
      border-radius:999px; border:1px solid rgba(255,255,255,.5);
      background:rgba(0,0,0,.40); color:#fff; font-size:14px;
      backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
      box-shadow:0 8px 24px rgba(0,0,0,.18); cursor:pointer; user-select:none;
      transition:opacity .25s ease, transform .25s ease, background .25s ease; z-index:20;
    }
    .music:hover{ transform:translateY(-1px); background:rgba(0,0,0,.5) }
    .music .dot{ width:8px; height:8px; border-radius:999px; background:#ff4d4f }
    .music.on .dot{ background:#3bd16f }
    .music .label{ letter-spacing:.2px }

    /* Save the Date + RSVP (show when lightbox is open) */
    .actions{
      position:fixed; left:50%; bottom:calc(16px + env(safe-area-inset-bottom));
      transform:translateX(-50%); z-index:15;
      display:flex; gap:8px; opacity:0; pointer-events:none;
      transition:opacity .28s ease, transform .28s ease;
      flex-wrap:wrap; justify-content:center;
    }
    .lightbox.visible + .actions { opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(-4px) }
    .btn{
      appearance:none; border:1px solid rgba(255,255,255,.6); color:#fff; background:rgba(0,0,0,.45);
      padding:10px 14px; border-radius:999px; font-size:14px; backdrop-filter:blur(6px);
      -webkit-backdrop-filter:blur(6px); box-shadow:0 8px 24px rgba(0,0,0,.18); cursor:pointer;
    }
    .btn:hover{ background:rgba(0,0,0,.56); transform:translateY(-1px) }

    @media (prefers-reduced-motion: reduce){ .bg, .invite, .hint{ animation-duration:.01s } }
  </style>
</head>
<body>
  <!-- Background -->
  <div class="bg" aria-hidden="true">
    <img src="assets/bg.jpg?v=23" alt="">
  </div>

  <!-- Invitation -->
  <img id="invite" class="invite" src="assets/image.jpg?v=23" alt="Wedding invitation">

  <!-- Hint -->
  <div id="hint" class="hint" aria-hidden="true">Tap to zoom</div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-hidden="true" role="dialog" aria-modal="true">
    <img id="lbimg" alt="Wedding invitation (zoomed)">
    <button class="close" aria-label="Close">×</button>
  </div>

  <!-- Actions: Apple Calendar + Google + Email RSVP -->
  <div id="actions" class="actions" aria-hidden="true">
    <button id="icsBtn" class="btn" aria-label="Add to Apple Calendar">Save to Apple Calendar</button>
    <button id="gcalBtn" class="btn" aria-label="Add to Google Calendar">Save to Google Calendar</button>
    <a id="rsvpBtn" class="btn" aria-label="Email RSVP" href="mailto:rsvp@luna.wedding?subject=RSVP%3A%20Luna%20Wedding&body=Hello%20Toby%20%26%20Michelle%2C%0A%0AWe%27re%20delighted%20to%20RSVP%20for%20June%205%2C%202026.%0A%0ANames%3A%20%0ANumber%20of%20Guests%3A%20%0ADietary%20notes%3A%20%0A%0AWith%20love%2C%0A" rel="noopener">Email RSVP</a>
  </div>

  <!-- Music button -->
  <button id="music" class="music" aria-pressed="false" aria-label="Toggle music">
    <span class="dot" aria-hidden="true"></span><span class="label">Music</span>
  </button>

  <noscript><style>.hint{display:none}</style></noscript>

  <script>
    (function(){
      const invite = document.getElementById('invite');
      const hint = document.getElementById('hint');
      const lb = document.getElementById('lightbox');
      const lbimg = document.getElementById('lbimg');
      const closeBtn = lb.querySelector('.close');
      const actionsWrap = document.getElementById('actions');
      const icsBtn = document.getElementById('icsBtn');
      const gcalBtn = document.getElementById('gcalBtn');
      const musicBtn = document.getElementById('music');

      /* ---------- Lightbox ---------- */
      function openLB(){
        lbimg.src = invite.src;
        lb.classList.add('visible');
        document.body.style.overflow = 'hidden';
        if (hint) hint.classList.add('hide');
        actionsWrap.setAttribute('aria-hidden','false');
        unlockAudio(); // counts as gesture if needed
      }
      function closeLB(){
        lb.classList.add('closing');
        setTimeout(()=>{ lb.classList.remove('visible');
          setTimeout(()=>{ lb.classList.remove('closing'); document.body.style.overflow=''; }, 300);
          actionsWrap.setAttribute('aria-hidden','true');
        },120);
      }
      invite.addEventListener('click', openLB, {passive:true});
      let lastTap=0;
      invite.addEventListener('touchend', e=>{
        const now=Date.now(); if(now-lastTap<300) openLB(); lastTap=now;
      }, {passive:true});
      lb.addEventListener('click', e=>{ if(e.target===lb) closeLB(); });
      closeBtn.addEventListener('click', closeLB);
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeLB(); });

      /* ---------- Calendar ---------- */
      const title   = 'Luna Wedding';
      const desc    = 'Dress Code: Formal Attire';
      const venue   = 'Carne Mare – Seaport';
      const address = '89 South St, New York, NY 10038';

      // Apple Maps deep link is handled by Calendar when LOCATION is recognized.
      // Extra boost: X-APPLE-STRUCTURED-LOCATION with geo:lat,long + title.
      // Coordinates approximate for Carne Mare (Seaport, NYC):
      const geoLat = 40.7061, geoLng = -74.0032;

      // June 5, 2026 — 7:00 PM to 10:00 PM ET
      const dtStartUTC = '20260605T230000Z'; // 7:00 PM ET
      const dtEndUTC   = '20260606T020000Z'; // 10:00 PM ET

      function fold(line){
        const CRLF = '\r\n';
        if (line.length <= 74) return line;
        let out = '';
        while (line.length > 74){
          out += line.slice(0,74) + CRLF + ' ';
          line = line.slice(74);
        }
        return out + line;
      }

      function downloadICSForApple(){
        const CRLF = '\r\n';
        const xApple = `X-APPLE-STRUCTURED-LOCATION;VALUE=URI;X-APPLE-RADIUS=72;X-TITLE=${venue.replace(/[,;]/g,'')}:geo:${geoLat},${geoLng}`;

        const lines = [
          'BEGIN:VCALENDAR',
          'VERSION:2.0',
          'PRODID:-//luna.wedding//SaveTheDate//EN',
          'CALSCALE:GREGORIAN',
          'METHOD:PUBLISH',
          'BEGIN:VEVENT',
          `UID:${crypto.randomUUID()}@luna.wedding`,
          `DTSTAMP:${new Date().toISOString().replace(/[-:]/g,'').split('.')[0]}Z`,
          `DTSTART:${dtStartUTC}`,
          `DTEND:${dtEndUTC}`,
          fold(`SUMMARY:${title}`),
          // Keep description minimal; iOS Calendar will still show Notes, but we avoid links here.
          fold(`DESCRIPTION:${desc}`),
          fold(`LOCATION:${venue}, ${address}`),
          fold(xApple),
          'END:VEVENT',
          'END:VCALENDAR'
        ];
        const ics = lines.join(CRLF) + CRLF;
        const blob = new Blob([ics], { type: 'text/calendar;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'LunaWedding.ics';
        document.body.appendChild(a);
        a.click(); a.remove();
        setTimeout(()=>URL.revokeObjectURL(url), 3000);
      }

      function openGCal(){
        const details = encodeURIComponent(desc);
        const text = encodeURIComponent(title);
        const location = encodeURIComponent(`${venue}, ${address}`);
        const href = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${text}&dates=${dtStartUTC}/${dtEndUTC}&details=${details}&location=${location}&sf=true&output=xml`;
        window.open(href, '_blank', 'noopener,noreferrer');
      }

      icsBtn.addEventListener('click', downloadICSForApple);
      gcalBtn.addEventListener('click', openGCal);

      /* ---------- Audio: robust iPad handling + 1s fade-in ---------- */
      let bgm = null, started = false, fadedIn = false;
      const TARGET_VOL = 0.35;
      const SRC = 'assets/bgm_small.mp3?v=23'; // cache-bust

      function createAudio(){
        if (bgm) return bgm;
        bgm = new Audio();
        bgm.src = SRC;
        bgm.loop = true;
        bgm.preload = 'auto';
        bgm.playsInline = true;
        bgm.volume = 0;
        started = true;
        return bgm;
      }

      function fadeTo(target=TARGET_VOL, ms=1000){
        if (!bgm) return;
        const start = performance.now();
        const v0 = bgm.volume;
        function step(t){
          const k = Math.min(1, (t - start) / ms);
          bgm.volume = v0 + (target - v0) * k;
          if (k < 1) requestAnimationFrame(step); else fadedIn = true;
        }
        requestAnimationFrame(step);
      }

      async function tryAutoPlayNow(){
        createAudio();
        try {
          bgm.muted = false;
          await bgm.play();
          if (bgm.volume === 0) fadeTo(TARGET_VOL, 1000);
        } catch {
          bgm.muted = true;
          bgm.play().catch(()=>{});
        }
      }

      async function unlockAudio(){
        createAudio();
        try {
          bgm.muted = false;
          if (bgm.paused) await bgm.play();
          if (!fadedIn) { bgm.volume = 0; fadeTo(TARGET_VOL, 1000); }
        } catch {
          setTimeout(async ()=>{
            try {
              bgm.muted = false;
              if (bgm.paused) await bgm.play();
              if (!fadedIn) { bgm.volume = 0; fadeTo(TARGET_VOL, 1000); }
            } catch(e){}
          }, 150);
        }
      }

      window.addEventListener('load', tryAutoPlayNow);
      ['pointerdown','click','touchend','keydown'].forEach(evt=>{
        window.addEventListener(evt, unlockAudio, { once:true, passive:true });
      });

      /* ---------- Music toggle (kept) ---------- */
      let pref = localStorage.getItem('music') || 'on';
      function setBtn(state){
        musicBtn.classList.toggle('on', state === 'on');
        musicBtn.setAttribute('aria-pressed', state === 'on' ? 'true' : 'false');
      }
      setBtn(pref);

      musicBtn.addEventListener('click', ()=>{
        createAudio();
        pref = (pref === 'on') ? 'off' : 'on';
        localStorage.setItem('music', pref);
        setBtn(pref);
        if (pref === 'on'){
          bgm.muted = false;
          if (bgm.paused) bgm.play().catch(()=>{});
          if (!fadedIn) { bgm.volume = 0; fadeTo(TARGET_VOL, 1000); }
          else { bgm.volume = TARGET_VOL; }
        } else {
          bgm.muted = true;
        }
      });

      // Hide hint after a moment
      setTimeout(()=>{ if (hint) hint.classList.add('hide'); }, 2500);
    })();
  </script>
</body>
</html>
